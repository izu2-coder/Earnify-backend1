from flask import Blueprint, request, jsonify withdrawals_bp = Blueprint('withdrawals', __name__) user_balances = {} MIN_WITHDRAWAL = 500 MAX_FEE = 100 @withdrawals_bp.route('/request', methods=['POST']) def request_withdrawal(): data = request.get_json() user_id = data.get('user_id') amount = float(data.get('amount', 0)) method = data.get('method') # e.g., "palm-pay", "paystack", "usdt" if not user_id or amount <= 0: return jsonify({"error": "Invalid input"}), 400 if user_balances.get(user_id, 0) < amount: return jsonify({"error": "Insufficient balance"}), 400 # Deduct amount from balance user_balances[user_id] -= amount # Apply fee (1%, max â‚¦100) fee = min(amount * 0.01, MAX_FEE) net_amount = amount - fee return jsonify({ "message": f"Withdrawal requested via {method}", "amount": amount, "fee": fee, "net": net_amount, "remaining_balance": user_balances[user_id] }), 200 @withdrawals_bp.route('/balance', methods=['GET']) def check_balance(): user_id = request.args.get('user_id') balance = user_balances.get(user_id, 0) return jsonify({"user_id": user_id, "balance": balance}), 200