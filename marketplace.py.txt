from flask import Blueprint, request, jsonify marketplace_bp = Blueprint('marketplace', __name__) # Simulated escrow accounts escrow_accounts = {} @marketplace_bp.route('/deposit', methods=['POST']) def deposit(): data = request.get_json() user_id = data.get('user_id') amount = float(data.get('amount', 0)) if not user_id or amount <= 0: return jsonify({"error": "Invalid input"}), 400 escrow_accounts[user_id] = escrow_accounts.get(user_id, 0) + amount return jsonify({ "message": "Deposit successful", "balance": escrow_accounts[user_id] }), 200 @marketplace_bp.route('/release', methods=['POST']) def release_payment(): data = request.get_json() buyer = data.get('buyer') seller = data.get('seller') amount = float(data.get('amount', 0)) if not buyer or not seller or amount <= 0: return jsonify({"error": "Invalid input"}), 400 if escrow_accounts.get(buyer, 0) < amount: return jsonify({"error": "Insufficient funds"}), 400 # Deduct 10% platform fee final_amount = amount * 0.9 escrow_accounts[buyer] -= amount escrow_accounts[seller] = escrow_accounts.get(seller, 0) + final_amount return jsonify({ "message": "Payment released", "seller_balance": escrow_accounts[seller] }), 200